---
layout: default
---

<script type="text/javascript" src="../js/vis.js"></script>
<script type="text/javascript" src="../js/underscore.js"></script>
<link href="../css/vis.css" rel="stylesheet" type="text/css" />

<style type="text/css">
    #mynetwork {
      width: 100%;
      height: 800px;
      border: 0px solid lightgray;
    }
</style>

<div class="container">
  {{ content }}
</div>

<div id="mynetwork"></div>

<script type="text/javascript">
document.addEventListener('DOMContentLoaded', async () => {
  try {
    const response = await fetch('/descartes-modules/course-sites/descartes-courses.csv');
    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

    const csvText = await response.text();
    const rows = csvText.trim().split('\n');

    const csvRegex = /,(?=(?:(?:[^"]*"){2})*[^"]*$)/;
    const courses2 = [];
    const courselinks = [];
    let idMap = {};
    let currentID = 1;

    const getID = () => currentID++;

    for (const row of rows) {
      if (row.trim() === '') continue;
      const fields = row.split(csvRegex).map(f => f.trim().replace(/^"|"$/g, ''));
      const [name, url, fullname, desc, prerequisites] = fields;

      const id = getID();
      idMap[name] = id;

      courses2.push({
        id: id,
        course: name,
        module: fullname,
        label: name + ": " + fullname,
        title: desc,
        shape: 'box',
        level: parseInt(name.substring(0, 2)) || 0
      });

      if (prerequisites) {
        prerequisites.split(';').forEach(prereq => {
          prereq = prereq.trim();
          if (prereq && idMap[prereq]) {
            courselinks.push({ from: idMap[prereq], to: id });
          }
        });
      }
    }

    const coursesDataSet = new vis.DataSet(courses2);
    const courseLinksDataSet = new vis.DataSet(courselinks);

    const container = document.getElementById('mynetwork');

    const data = {
      nodes: coursesDataSet,
      edges: courseLinksDataSet
    };

    const options = {
      edges: { arrows: 'to' },
      layout: { hierarchical: { direction: "LR" } }
    };

    new vis.Network(container, data, options);

  } catch (error) {
    console.error('Error loading or processing course data:', error);
    document.getElementById('mynetwork').innerHTML =
      '<p class="text-center text-muted">Error loading course graph.</p>';
  }
});
</script>